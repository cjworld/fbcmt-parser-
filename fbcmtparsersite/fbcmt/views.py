from .serializers import UserSerializer, PostSerializer, PhotoSerializer
from .models import User, Post, Photo
from .permissions import PostAuthorCanEditPermission
from rest_framework import generics, permissions

from django.shortcuts import render_to_response, redirect, render
from django.contrib.auth import logout as auth_logout
from django.contrib.auth.decorators import login_required

from django.http import JsonResponse
import facebook
import google
import datetime
import json


class PostMixin(object):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = [
        PostAuthorCanEditPermission
    ]

    def perform_create(self, obj):
        obj.save(author = self.request.user)


class UserList(generics.ListCreateAPIView):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = (
        permissions.AllowAny,
    )


class UserDetail(generics.RetrieveAPIView):
    model = User
    serializer_class = UserSerializer
    lookup_field = 'username'



class PostList(PostMixin, generics.ListCreateAPIView):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = (
        permissions.AllowAny,
    )


class PostDetail(PostMixin, generics.RetrieveUpdateDestroyAPIView):
    model = Post
    serializer_class = PostSerializer
    permission_classes = [
        permissions.AllowAny
    ]


class UserPostList(generics.ListAPIView):
    model = Post
    serializer_class = PostSerializer

    def get_queryset(self):
        queryset = super(UserPostList, self).get_queryset()
        return queryset.filter(author__username=self.kwargs.get('username'))


class PhotoList(generics.ListCreateAPIView):
    model = Photo
    serializer_class = PhotoSerializer
    permission_classes = [
        permissions.AllowAny
    ]


class PhotoDetail(generics.RetrieveUpdateDestroyAPIView):
    model = Photo
    serializer_class = PhotoSerializer
    permission_classes = [
        permissions.AllowAny
    ]


class PostPhotoList(generics.ListAPIView):
    serializer_class = PhotoSerializer

    def get_queryset(self):
        queryset = Photo.objects.all()
        return queryset.filter(post__pk=self.kwargs.get('pk'))


def logout(request):
    auth_logout(request)
    return redirect('/parser/')


def FacebookGraphAPI(request):
    
    print ">> New incoming request:", request.GET
    reply_on_post = True if request.GET.get('reply_on_post') == u'true' else False
    google_mail = request.GET.get('google_mail')
    
    starting_time = datetime.datetime.now()
    social_user = request.user.social_auth.filter(
        provider='facebook',
    ).first()
    access_token = social_user.extra_data.get('access_token')
    facebook_url = request.GET.get('facebook_url').strip()
    ret_json = facebook.customized_parser(facebook_url, access_token, reply_on_post=reply_on_post)
    '''
    ret_json = {'posts': [{'message': u'01 \uff1a\u5929\u7a7a\u3001\u96fb\u7dda\u3001\u591c\u88573\u53771\u7d44 1500\u5143\u3002(\u552e2\u7d44\uff09', 'comments': []}, {'message': u'[\u5df2\u552e\u5b8c] 02 \uff1a \u6c11\u65cf\u8863\u88dd >A\u9ec3\u8272\u6b3e300\u5143 \uff08\u552e4\u5377\uff09\uff1bB\u85cd\u8272\u6b3e310\u5143\uff08\u552e4\u5377\uff09\u3002', 'comments': [{u'from': {u'name': u'\u5f35\u96c5\u8c6c', u'id': u'10202500960399893'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:33:04+0000', u'message': u'A+1', u'id': u'466023766938184', u'user_likes': False}, {u'from': {u'name': u'\u9673\u8c9e\u5b87', u'id': u'610863522336185'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:33:41+0000', u'message': u'A+1', u'id': u'466023823604845', u'user_likes': False}, {u'from': {u'name': u'Belinda Hsiung', u'id': u'778181552192624'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:41:58+0000', u'message': u'B+1', u'id': u'466025153604712', u'user_likes': False}, {u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:23:25+0000', u'message': u'A+1', u'id': u'466037860270108', u'user_likes': False}, {u'from': {u'name': u'Iyun Liuliuliu', u'id': u'853515781327224'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:06:33+0000', u'message': u'\u3002B+1', u'id': u'466044226936138', u'user_likes': False}, {u'from': {u'name': u'Jian Chou', u'id': u'787155247970225'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:14:24+0000', u'message': u'AB\u5404\u4e00', u'id': u'466058670268027', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T13:23:48+0000', u'message': u'----A\u9ec3\u8272\u6b3e\u5df2\u552e\u5b8c\uff0cB\u85cd\u8272\u6b3e\u99181\u5377-----', u'id': u'466082433598984', u'user_likes': False}, {u'from': {u'name': u'Chang- Sue', u'id': u'885740621444810'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T14:38:28+0000', u'message': u'B+1', u'id': u'466099990263895', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T16:59:50+0000', u'message': u'------\u552e\u5b8c------', u'id': u'466132943593933', u'user_likes': False}]}, {'message': u'03 :  A\u5c0f\u623f\u5b50 200\u5143\uff08\u552e4\u5377\uff09\uff1bB\u8c93\u54aa 200\u5143\uff08\u552e4\u5377\uff09\uff1bC\u5c0f\u9ce5180\u5143\uff08\u552e10\u5377\uff09\u3002', 'comments': [{u'from': {u'name': u'Shiou Shan', u'id': u'891770357505762'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T08:59:37+0000', u'message': u'\u5404+1', u'id': u'466017836938777', u'user_likes': False}, {u'from': {u'name': u'Isabelle  Yeh', u'id': u'706256339488977'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:21:13+0000', u'message': u'\u592a\u4fbf\u5b9c\u4e86\u5427\U0001f60d', u'id': u'466021716938389', u'user_likes': False}, {u'from': {u'name': u'\u6eab\u672c\u8587', u'id': u'770234929662843'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:31:22+0000', u'message': u'A+1\nB+1', u'id': u'466023560271538', u'user_likes': False}, {u'from': {u'name': u'\u9673\u8c9e\u5b87', u'id': u'610863522336185'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:32:44+0000', u'message': u'A+1', u'id': u'466023750271519', u'user_likes': False}, {u'from': {u'name': u'Belinda Hsiung', u'id': u'778181552192624'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:42:42+0000', u'message': u'A+1 B+1', u'id': u'466026603604567', u'user_likes': False}, {u'from': {u'name': u'\u7fc1\u7dad\u8476', u'id': u'973804449303684'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:43:53+0000', u'message': u'b+1', u'id': u'466026690271225', u'user_likes': False}, {u'from': {u'name': u'\u694a\u96c5\u82af', u'id': u'675260972568465'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:45:01+0000', u'message': u'B+1', u'id': u'466026760271218', u'user_likes': False}, {u'from': {u'name': u'Yu Hsuan Sung', u'id': u'10201832297801445'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:56:08+0000', u'message': u'A+1', u'id': u'466028633604364', u'user_likes': False}, {u'from': {u'name': u'Yui Hinata', u'id': u'1404526559866174'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:06:56+0000', u'message': u'\u6392AB+1', u'id': u'466034560270438', u'user_likes': False}, {u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:10:00+0000', u'message': u'A+1', u'id': u'466035303603697', u'user_likes': False}, {u'from': {u'name': u'\u738b\u839b\u96c5', u'id': u'726925520680046'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:10:46+0000', u'message': u'C+1', u'id': u'466035466937014', u'user_likes': False}, {u'from': {u'name': u'\u6c88\u4e8e\u65b0', u'id': u'881779281848298'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:12:34+0000', u'message': u'C+1', u'id': u'466036073603620', u'user_likes': False}, {u'from': {u'name': u'\u6c88\u4e8e\u65b0', u'id': u'881779281848298'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:12:54+0000', u'message': u'\u5019\u88dcAB', u'id': u'466036123603615', u'user_likes': False}, {u'from': {u'name': u'\u6797\u66c9\u611b', u'id': u'682837711774042'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:24:30+0000', u'message': u'\u5019\u88dcAC \u5982\u679c\u6c92\u6709\u5169\u6372\u4e00\u8d77\u5f8c\u88dc\u5230\u5c31\u653e\u68c4', u'id': u'466038006936760', u'user_likes': False}, {u'from': {u'name': u'\u6f58\u6085\u6085', u'id': u'397553750402519'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:26:02+0000', u'message': u'A+1', u'id': u'466038180270076', u'user_likes': False}, {u'from': {u'name': u'Wei Xuan Chen', u'id': u'10152906610424470'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:27:14+0000', u'message': u'\u5404\u4e00', u'id': u'466038410270053', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 4, u'offset': 57, u'type': u'user', u'id': u'10201832297801445', u'name': u'Yu Hsuan Sung'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:48:09+0000', u'message': u'A\u6b3e\u6709\u558a\u5230\u7684\u53ea\u6709\u524d\u4e94\u4f4d : Shiou Shan\uff0c\u6eab\u672c\u8587\uff0c\u9673\u8c9e\u5b87\uff0cBelinda Hsiung\uff0cYu Hsuan Sung\u3002', u'id': u'466041726936388', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:49:27+0000', u'message': u'B\u6b3e\u6709\u558a\u5230\u7684\u53ea\u6709\u524d\u4e94\u4f4d :Shiou Shan\uff0c\u6eab\u672c\u8587\uff0cBelinda Hsiung\uff0c\u7fc1\u7dad\u8476\uff0c\u694a\u96c5\u82af', u'id': u'466041853603042', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:50:13+0000', u'message': u'A.B\u5df2\u7d93\u552e\u5b8c\uff0c\u4e0d\u6703\u518d\u88dc\uff0c\u53ea\u5269C\u6b3e\u5c0f\u9ce5\u3002', u'id': u'466041903603037', u'user_likes': False}, {u'from': {u'name': u'Jian Chou', u'id': u'787155247970225'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:14:42+0000', u'message': u'C+1', u'id': u'466058753601352', u'user_likes': False}, {u'from': {u'name': u'Lee Meng-lin', u'id': u'10200619752735117'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T14:40:20+0000', u'message': u'C+1', u'id': u'466100576930503', u'user_likes': False}, {u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:02:55+0000', u'message': u'C+1', u'id': u'466133543593873', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 3, u'offset': 0, u'type': u'user', u'id': u'10152906610424470', u'name': u'Wei Xuan Chen'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T18:33:20+0000', u'message': u'\u9673\u97cb\u7487 A.B\u5df2\u7d93\u88ab\u558a\u5b8c\u4e86\uff0c\u55aeC\u6b3e\u9084\u8981\u55ce?', u'id': u'466158553591372', u'user_likes': False}, {u'from': {u'name': u'Wei Xuan Chen', u'id': u'10152906610424470'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-15T01:33:23+0000', u'message': u'\u8981', u'id': u'466242050249689', u'user_likes': False}, {u'from': {u'name': u'Milka  Lafelino', u'id': u'595443240582086'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-15T01:52:15+0000', u'message': u'C+1', u'id': u'466250306915530', u'user_likes': False}]}, {'message': u'[\u5df2\u552e\u5b8c]  04 \uff1a \u9905\u4e7e\u6d3e\u5c0d&\u6599\u7406\u98df\u8b5c\u66f8 400\u5143\u3002\uff08\u552e2\u7d44\uff09', 'comments': [{u'from': {u'name': u'Yen-fei Chen', u'id': u'848533991828844'}, u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-14T10:23:38+0000', u'message': u'\u8acb\u554f\u6709\u5c55\u958b\u5716\u55ce?', u'id': u'466037890270105', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 12, u'offset': 0, u'type': u'user', u'id': u'848533991828844', u'name': u'Yen-fei Chen'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:40:08+0000', u'message': u'Yen-fei Chen \u5c55\u958b', u'id': u'466040476936513', u'user_likes': False}, {u'from': {u'name': u'Iyun Liuliuliu', u'id': u'853515781327224'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:07:02+0000', u'message': u'+1', u'id': u'466044286936132', u'user_likes': False}, {u'from': {u'name': u'\u5f6d\u96c5\u82ac', u'id': u'738106589544126'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:35:11+0000', u'message': u'+1', u'id': u'466048730269021', u'user_likes': False}, {u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:36:56+0000', u'message': u'+1', u'id': u'466049003602327', u'user_likes': False}, {u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:30:42+0000', u'message': u'+1\U0001f602', u'id': u'466061943601033', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 2, u'can_remove': False, u'created_time': u'2016-01-14T13:24:42+0000', u'message': u'\u5df2\u552e\u5b8c\uff0c\u53ea\u6709\u524d\u5169\u4f4d\u6709\u558a\u5230 (Iyun Liuliuliu\uff0c\u5f6d\u96c5\u82ac)\u3002', u'id': u'466082710265623', u'user_likes': False}, {u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T13:45:29+0000', u'message': u'\u54c8\u54c8\uff0c\u597d\u53ef\u60dc\u554a\u2026', u'id': u'466087410265153', u'user_likes': False}]}, {'message': u'05 \uff1a KONOHANA \u590f\u4e4b\u91ce\u82b1 350\u5143\u3002\uff08\u552e1\u5377\uff09', 'comments': [{u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:06:27+0000', u'message': u'+1', u'id': u'466134186927142', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T19:53:51+0000', u'message': u'----\u552e\u5b8c------', u'id': u'466173210256573', u'user_likes': False}]}, {'message': u'06 \uff1aKONOHANA \u677e\u8449\u7261\u4e39\u8207\u7d2b\u9732\u8349 250\u5143\u3002\uff08\u552e1\u5377\uff09', 'comments': []}, {'message': u'07 \uff1a \u9ec3\u660f\u6d77\u5cb8&\u591c\u665a\u666f\u8272 450\u5143\u3002 (\u552e3\u7d44\uff09', 'comments': [{u'from': {u'name': u'\u694a\u96c5\u82af', u'id': u'675260972568465'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:18:35+0000', u'message': u'+1', u'id': u'466036976936863', u'user_likes': False}]}, {'message': u'[\u5df2\u552e\u5b8c]  08 \uff1a\u9583\u4eae\u5bf6\u77f3\u788e\u7247 200\u5143\u3002\uff08\u552e3\u5377\uff09', 'comments': [{u'from': {u'name': u'\u5f35\u96c5\u8c6c', u'id': u'10202500960399893'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T09:32:12+0000', u'message': u'+1', u'id': u'466023650271529', u'user_likes': False}, {u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:05:19+0000', u'message': u'+1', u'id': u'466057593601468', u'user_likes': False}, {u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:31:31+0000', u'message': u'+1', u'id': u'466062036934357', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T13:25:17+0000', u'message': u'-----\u552e\u5b8c----', u'id': u'466082813598946', u'user_likes': False}]}, {'message': u'09 : \u9eb5\u5305\u5154> A\u9ed1\u8272\u6b3e450\u5143(\u552e7\u5377)\uff1bB\u767d\u8272\u6b3e 350\u5143(\u552e6\u5377)\u3002', 'comments': [{u'from': {u'name': u'\u5b8b\u82b8\u8431', u'id': u'677183572354996'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:00:08+0000', u'message': u'B+1', u'id': u'466031276937433', u'user_likes': False}, {u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:15:42+0000', u'message': u'A+1', u'id': u'466036556936905', u'user_likes': False}, {u'from': {u'name': u'Julian Wei', u'id': u'10203383857693977'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:50:59+0000', u'message': u'B+1', u'id': u'466070026933558', u'user_likes': False}, {u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T16:50:13+0000', u'message': u'B+1', u'id': u'466130223594205', u'user_likes': False}, {u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:13:58+0000', u'message': u'A+1', u'id': u'466138836926677', u'user_likes': False}, {u'from': {u'name': u'\u8a31\u60e0\u9594', u'id': u'821525034538269'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T18:10:10+0000', u'message': u'B+1', u'id': u'466153273591900', u'user_likes': False}]}, {'message': u'10 : mas*T > A\u6298\u7d19\u9db465\u5143(\u552e10\u5377)\uff1bB\u85cd\u82b1\u65b9\u683c65\u5143(\u552e2\u5377)\uff1bC\u91ce\u83dc70\u5143(\u552e1\u5377)\uff1bD\u9ed1\u8c9370\u5143(\u552e1\u5377)\uff1bE\u8449\u5b5070\u5143(\u552e1\u5377)\uff1bF\u5c71\u8207\u68ee70\u5143(\u552e1\u5377)\uff1bG\u6050\u9f8d75\u5143(\u552e1\u5377)\uff1bH\u85cd\u8272\u5708\u5708\u72d790\u5143(\u552e3\u5377)\uff1bI\u6563\u6b65\u5730\u5716  65\u5143(\u552e4\u5377) \uff1bJ\u767d\u8272\u5708\u5708\u72d790\u5143(\u552e2\u5377)\uff1bK\u4fc4\u7f85\u65af\u5a03\u5a0365\u5143(\u552e3\u5377)\uff1bL\u82a5\u5b50\u5a03\u5a0365\u5143(\u552e2\u5377)\u3002', 'comments': [{u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:30:15+0000', u'message': u'C+1', u'id': u'466038910270003', u'user_likes': False}, {u'from': {u'name': u'\u5f6d\u96c5\u82ac', u'id': u'738106589544126'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:47:52+0000', u'message': u'D+1', u'id': u'466052523601975', u'user_likes': False}, {u'from': {u'name': u'Yu Hsuan Sung', u'id': u'10201832297801445'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:56:43+0000', u'message': u'AH+1', u'id': u'466056360268258', u'user_likes': False}, {u'from': {u'name': u'Jian Chou', u'id': u'787155247970225'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:19:04+0000', u'message': u'Befghi+1', u'id': u'466059746934586', u'user_likes': False}, {u'from': {u'name': u'Julian Wei', u'id': u'10203383857693977'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:52:42+0000', u'message': u'L\u82a5\u5b50\u5a03\u5a03+1\nG\u6050\u9f8d\u5982\u679c\u9084\u6709\u7684\u8a71\u4e5f+1\U0001f602', u'id': u'466070466933514', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-14T13:02:14+0000', u'message': u'\u4e0d\u597d\u610f\u601d\u7de8\u865f\u6253\u932f\uff0c\u82a5\u5b50\u5a03\u5a03\u7684\u7de8\u865f\u5df2\u7d93\u66f4\u6b63\u70baL\u3002', u'id': u'466073426933218', u'user_likes': False}, {u'from': {u'name': u'\u5409\u842c', u'id': u'805454519464760'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T15:03:16+0000', u'message': u'K\uff0b1L\uff0b1', u'id': u'466106633596564', u'user_likes': False}, {u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:44:17+0000', u'message': u'A +1', u'id': u'466148983592329', u'user_likes': False}, {u'from': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:46:31+0000', u'message': u'I+1', u'id': u'466149370258957', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:52:49+0000', u'message': u'C.D.E.F.G.L\u5df2\u552e\u5b8c', u'id': u'466150283592199', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:57:02+0000', u'message': u'A\u99188\u5377 / B\u99181\u5377 / H\u99181\u5377 / I \u99182\u5377 / J\u99182\u5377 / K\u99182\u5377\u3002', u'id': u'466150940258800', u'user_likes': False}]}, {'message': u'11 : A\u5c0f\u72d7 160\u5143(\u552e2\u5377)\uff1bB\u5c0f\u52d5\u7269\u8272\u925b\u7b46160\u5143(\u552e4\u5377)', 'comments': [{u'from': {u'name': u'Iyun Liuliuliu', u'id': u'853515781327224'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:07:54+0000', u'message': u'\u5404+1', u'id': u'466044500269444', u'user_likes': False}, {u'from': {u'name': u'\u8a31\u8212\u9591', u'id': u'622953497801999'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T16:35:53+0000', u'message': u'\u8acb\u554f\u6709\u72d7\u72d7\u5c55\u958b\u55ce', u'id': u'466126853594542', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 3, u'offset': 0, u'type': u'user', u'id': u'622953497801999', u'name': u'\u8a31\u8212\u9591'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T17:01:00+0000', u'message': u'\u52d5\u529b\u9591', u'id': u'466133163593911', u'user_likes': False}, {u'from': {u'name': u'Joanne Chiang', u'id': u'10152843906514328'}, u'message_tags': [{u'length': 10, u'offset': 0, u'type': u'user', u'id': u'675702712467300', u'name': u'Yu Wen Lee'}], u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-15T02:23:03+0000', u'message': u'Yu Wen Lee\u53ef\u4ee5\u5e6b\u6211\u558aB\u55ce\uff1f', u'id': u'466254980248396', u'user_likes': False}, {u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-15T02:30:19+0000', u'message': u'B+1', u'id': u'466256413581586', u'user_likes': False}]}, {'message': u'12 : \u4f01\u9d5d > A\u5b63\u7bc0\u7bc0\u65e5160\u5143(\u552e2\u5377)\uff1bB\u5404\u7a2e\u4f01\u9d5d160\u5143(\u552e2\u5377)\uff1b\u51ac\u5b63\u96ea\u82b1190\u5143(\u552e2\u5377)\u3002', 'comments': [{u'from': {u'name': u'\u6eab\u672c\u8587', u'id': u'770234929662843'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T10:32:52+0000', u'message': u'A+1', u'id': u'466039120269982', u'user_likes': False}]}, {'message': u'13 : A\u904b\u52d5\u54e1200\u5143(\u552e4\u5377)\uff1bB\u5bae\u5d0e\u540d\u6240200\u5143(\u552e4\u5377)\uff1bC\u65e5\u5e38\u8863\u8457220\u5143(\u552e9\u5377)\uff1bD\u52d5\u7269\u78e8\u83c7240\u5143(\u552e7\u5377)\u3002', 'comments': [{u'from': {u'name': u'\u5f6d\u96c5\u82ac', u'id': u'738106589544126'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:49:26+0000', u'message': u'D+1', u'id': u'466052876935273', u'user_likes': False}, {u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:31:21+0000', u'message': u'C+1', u'id': u'466062016934359', u'user_likes': False}]}, {'message': u'14 : Bunno Junky > A\u5154\u5b50\u6d77\u8ecd 180\u5143(\u552e1\u5377)\uff1bB\u82b1\u8207\u5c0f\u9ce5180\u5143(\u552e1\u5377)\uff1bC\u5154\u5b50\u904a\u6a02\u5712180\u5143(\u552e1\u5377)\uff1bD\u5154\u5b50\u7dde\u5e36120\u5143\u552e3\u5377\uff0cE\u8c93\u54aa\u62c9\u934a130\u5143(\u552e2\u5377)\uff1bF\u98ef\u98df\u6b3e180\u5143(\u552e2\u5377)\uff1bG\u842c\u8056\u7bc0180\u5143(\u552e3\u5377)\u3002', 'comments': [{u'from': {u'name': u'\u5f6d\u96c5\u82ac', u'id': u'738106589544126'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:38:08+0000', u'message': u'D+1', u'id': u'466049516935609', u'user_likes': False}, {u'from': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:01:40+0000', u'message': u'D.F.G\u5404+1', u'id': u'466056980268196', u'user_likes': False}]}, {'message': u'15 \uff1akanahei \u7684\u5c0f\u52d5\u7269 P\u52a9\u6b3e 230\u5143 \uff08\u552e1\u5377\uff09', 'comments': [{u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:14:34+0000', u'message': u'\u5c55\u958b (\u4e0b\u9762\u90a3\u6b3e)', u'id': u'466045333602694', u'user_likes': False}]}, {'message': u'16\uff1akanahei \u7684\u5c0f\u52d5\u7269  230\u5143 \uff08\u552e1\u5377\uff09', 'comments': []}, {'message': u'\u5c55\u958b (\u4e0a\u9762\u90a3\u6b3e)', 'comments': []}, {'message': u'17 \uff1a\u65c5\u5c4b \u70cf\u9d09&\u897f\u6d0b\u68cb 500\u5143\uff08\u552e2\u7d44\uff09', 'comments': []}, {'message': u'18: \u65c5\u5c4b \u6587\u5177&\u65c5\u884c 520\u5143 \uff08\u552e2\u7d44\uff09', 'comments': []}, {'message': u'19 \uff1a \u5404\u5f0f\u5404\u6a23\u7684\u9eb5\u5305 260\u5143 \uff08\u552e3\u5377\uff09', 'comments': [{u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:08:09+0000', u'message': u'\u8acb\u554f\u6709\u9019\u6372\u7684\u5c55\u958b\u55ce\uff1f\u8b1d\u8b1d\u59b3', u'id': u'466057880268106', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 13, u'offset': 0, u'type': u'user', u'id': u'10204510885796350', u'name': u'Mosquito Tsai'}], u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-14T12:09:22+0000', u'message': u'Mosquito Tsai', u'id': u'466058060268088', u'user_likes': False}]}, {'message': u'20 \uff1a\u6cd5\u5f0f\u9eb5\u5305  180\u5143 \uff08\u552e1\u5377\uff09', 'comments': [{u'from': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:31:57+0000', u'message': u'+1', u'id': u'466062656934295', u'user_likes': False}, {u'from': {u'name': u'Julian Wei', u'id': u'10203383857693977'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-15T01:59:00+0000', u'message': u'\u5019\u88dc><', u'id': u'466251460248748', u'user_likes': False}]}, {'message': u'21 \uff1aHappy Bakery 300\u5143 \uff08\u552e2\u5377\uff09\u3002', 'comments': [{u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T11:59:49+0000', u'message': u'\u8acb\u554f\u6709\u9019\u5169\u5377\u7684\u5c55\u958b\u5716\u55ce\uff1f\u8b1d\u8b1d', u'id': u'466056743601553', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 13, u'offset': 0, u'type': u'user', u'id': u'10204510885796350', u'name': u'Mosquito Tsai'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:01:16+0000', u'message': u'Mosquito Tsai \u5c55\u958b', u'id': u'466056916934869', u'user_likes': False}, {u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:04:51+0000', u'message': u'+1', u'id': u'466057500268144', u'user_likes': False}, {u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:05:03+0000', u'message': u'\u5169\u5377\u9577\u4e00\u6a23\u55ce\uff1f', u'id': u'466057546934806', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'like_count': 1, u'can_remove': False, u'created_time': u'2016-01-14T12:07:15+0000', u'message': u'\u90fd\u4e00\u6a23\uff0c\u53ea\u662f\u5713\u6a19\u5716\u6848\u4e0d\u540c~', u'id': u'466057786934782', u'user_likes': False}, {u'from': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'message_tags': [{u'length': 13, u'offset': 0, u'type': u'user', u'id': u'10204510885796350', u'name': u'Mosquito Tsai'}], u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:10:34+0000', u'message': u'Mosquito Tsai \u8acb\u554f\u5713\u6a19\u60f3\u6311\u54ea\u500b\uff0c\u5148\u558a\u7684\u53ef\u5148\u6311~', u'id': u'466058173601410', u'user_likes': False}, {u'from': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'like_count': 0, u'can_remove': False, u'created_time': u'2016-01-14T12:13:35+0000', u'message': u'\u5de6\u908a \u8b1d\u8b1d', u'id': u'466058580268036', u'user_likes': False}]}], 'users': {u'595443240582086': {u'name': u'Milka  Lafelino', u'id': u'595443240582086'}, u'885740621444810': {u'name': u'Chang- Sue', u'id': u'885740621444810'}, u'738106589544126': {u'name': u'\u5f6d\u96c5\u82ac', u'id': u'738106589544126'}, u'770234929662843': {u'name': u'\u6eab\u672c\u8587', u'id': u'770234929662843'}, u'821525034538269': {u'name': u'\u8a31\u60e0\u9594', u'id': u'821525034538269'}, u'778181552192624': {u'name': u'Belinda Hsiung', u'id': u'778181552192624'}, u'10152896353859803': {u'name': u'Moon Fang', u'id': u'10152896353859803'}, u'10152843906514328': {u'name': u'Joanne Chiang', u'id': u'10152843906514328'}, u'848533991828844': {u'name': u'Yen-fei Chen', u'id': u'848533991828844'}, u'10200619752735117': {u'name': u'Lee Meng-lin', u'id': u'10200619752735117'}, u'10152906610424470': {u'name': u'Wei Xuan Chen', u'id': u'10152906610424470'}, u'853515781327224': {u'name': u'Iyun Liuliuliu', u'id': u'853515781327224'}, u'891770357505762': {u'name': u'Shiou Shan', u'id': u'891770357505762'}, u'10203383857693977': {u'name': u'Julian Wei', u'id': u'10203383857693977'}, u'10201852384214051': {u'name': u'September Chang', u'id': u'10201852384214051'}, u'976697352346294': {u'name': u'Pei-Hui Lin', u'id': u'976697352346294'}, u'1532466803650245': {u'name': u'Yui Liuan', u'id': u'1532466803650245'}, u'10202500960399893': {u'name': u'\u5f35\u96c5\u8c6c', u'id': u'10202500960399893'}, u'677183572354996': {u'name': u'\u5b8b\u82b8\u8431', u'id': u'677183572354996'}, u'610863522336185': {u'name': u'\u9673\u8c9e\u5b87', u'id': u'610863522336185'}, u'1404526559866174': {u'name': u'Yui Hinata', u'id': u'1404526559866174'}, u'675702712467300': {u'name': u'Yu Wen Lee', u'id': u'675702712467300'}, u'675260972568465': {u'name': u'\u694a\u96c5\u82af', u'id': u'675260972568465'}, u'973804449303684': {u'name': u'\u7fc1\u7dad\u8476', u'id': u'973804449303684'}, u'682837711774042': {u'name': u'\u6797\u66c9\u611b', u'id': u'682837711774042'}, u'787155247970225': {u'name': u'Jian Chou', u'id': u'787155247970225'}, u'805454519464760': {u'name': u'\u5409\u842c', u'id': u'805454519464760'}, u'622953497801999': {u'name': u'\u8a31\u8212\u9591', u'id': u'622953497801999'}, u'10201832297801445': {u'name': u'Yu Hsuan Sung', u'id': u'10201832297801445'}, u'881779281848298': {u'name': u'\u6c88\u4e8e\u65b0', u'id': u'881779281848298'}, u'397553750402519': {u'name': u'\u6f58\u6085\u6085', u'id': u'397553750402519'}, u'10204510885796350': {u'name': u'Mosquito Tsai', u'id': u'10204510885796350'}, u'726925520680046': {u'name': u'\u738b\u839b\u96c5', u'id': u'726925520680046'}, u'706256339488977': {u'name': u'Isabelle  Yeh', u'id': u'706256339488977'}}}
    '''
    
    now_time = datetime.datetime.now()
    print ">> Time consumed so far:", now_time-starting_time
    
    spreadsheet_name = "AutoGenRobot" + now_time.strftime("%Y%m%d%H%M%S")
    g_ss_svc = google.GoogleSpreadSheetService()
    if google_mail is not None and len(google_mail.strip()) > 0:
        sh = g_ss_svc.create_a_spreadsheet(spreadsheet_name, email_list=[google_mail])
    else:
        sh = g_ss_svc.create_a_spreadsheet(spreadsheet_name)
    google.update_google_spreadsheet(sh, ret_json.get('users'), ret_json.get('posts'))
    
    ending_time = datetime.datetime.now()
    
    print ">> Total time consumed:", ending_time-starting_time
    
    return JsonResponse(ret_json)
    
def FacebookGraphAPI_get_comments(request):
    
    print ">> New incoming request:", request.GET
    reply_on_post = True if request.GET.get('reply_on_post') == u'true' else False
    
    starting_time = datetime.datetime.now()
    social_user = request.user.social_auth.filter(
        provider='facebook',
    ).first()
    access_token = social_user.extra_data.get('access_token')
    facebook_url = request.GET.get('facebook_url').strip()
    
    object_id = facebook.get_object_id(facebook_url)
    print '>> object_id:', object_id
    ret_json = facebook.get_comments(object_id, access_token)
    
    return JsonResponse(ret_json)
    
def GoogleDriveAPI_new_spreadsheet(request):
    
    print ">> New incoming request:", request.GET
    google_mail = request.GET.get('google_mail')
    spreadsheet_data = request.GET.get('spreadsheet_data')
    spreadsheet_data = json.loads(spreadsheet_data)
    
    starting_time = datetime.datetime.now()
    print ">> Start processing: ", starting_time
    
    spreadsheet_name = "AutoGenRobot" + starting_time.strftime("%Y%m%d%H%M%S")
    g_ss_svc = google.GoogleSpreadSheetService()
    if google_mail is not None and len(google_mail.strip()) > 0:
        sh = g_ss_svc.create_a_spreadsheet(spreadsheet_name, email_list=[google_mail])
    else:
        sh = g_ss_svc.create_a_spreadsheet(spreadsheet_name)
    google.update_google_spreadsheet_simple(sh, spreadsheet_data)
    
    ending_time = datetime.datetime.now()
    
    print ">> Total time consumed:", ending_time-starting_time
    
    return JsonResponse({'status':200})